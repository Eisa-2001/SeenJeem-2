<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€” Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ© (Ù…Ù„Ù ÙˆØ§Ø­Ø¯)</title>
  <style>
    :root{
      --bg:#070a12; --panel:#0f1630; --panel2:#121b3a; --text:#e9eeff; --muted:#a9b4e6;
      --line:rgba(255,255,255,.12); --a1:#67e8f9; --a2:#a78bfa;
      --good:#22c55e; --bad:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:radial-gradient(900px 700px at 15% 10%, rgba(103,232,249,.12), transparent 60%),
                 radial-gradient(900px 700px at 85% 10%, rgba(167,139,250,.10), transparent 60%),
                 var(--bg);
      color:var(--text);
    }
    header{
      position:sticky;top:0;z-index:10;
      background:rgba(7,10,18,.72);backdrop-filter:blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topbar{max-width:1100px;margin:0 auto;padding:10px 14px;display:flex;align-items:center;justify-content:space-between;gap:10px}
    .brand{display:flex;gap:10px;align-items:center}
    .logo{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,var(--a1),var(--a2))}
    h1{margin:0;font-size:15px}
    .sub{font-size:12px;color:var(--muted)}
    .btns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    button{
      cursor:pointer;border:1px solid var(--line);background:rgba(255,255,255,.04);
      color:var(--text);padding:10px 12px;border-radius:12px;font-weight:800
    }
    button:hover{background:rgba(255,255,255,.07)}
    button.primary{border:none;background:linear-gradient(135deg,var(--a1),var(--a2));color:#0b1020}
    button.danger{border-color:rgba(239,68,68,.45)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .page{display:none}
    .page.active{display:block}
    .card{background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:18px;padding:14px}
    .grid{display:grid;gap:12px}
    .grid.two{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media(max-width:840px){.grid.two{grid-template-columns:1fr}}
    .titleRow{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:10px}
    .titleRow h2{margin:0;font-size:15px}
    .small{font-size:12px;color:var(--muted)}
    .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
    label{font-size:12px;color:var(--muted)}
    input[type="text"], input[type="number"]{
      padding:12px;border-radius:12px;border:1px solid var(--line);
      background:rgba(0,0,0,.25);color:var(--text)
    }
    .pill{padding:8px 10px;border-radius:999px;border:1px solid var(--line);background:rgba(255,255,255,.03);font-size:12px;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .toggle{display:flex;gap:10px;align-items:center;margin-top:10px}
    input[type="checkbox"]{width:18px;height:18px}
    .scorebar{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:10px}
    .scorebox{display:flex;gap:10px;align-items:center;background:rgba(255,255,255,.04);border:1px solid var(--line);border-radius:14px;padding:10px 12px}
    .scorebox .name{font-weight:900}
    .scorebox .score{font-size:18px;font-weight:1000;background:linear-gradient(135deg,var(--a1),var(--a2));-webkit-background-clip:text;background-clip:text;color:transparent}
    .timer{font-variant-numeric:tabular-nums;font-weight:900}
    .board{display:grid;gap:10px;grid-template-columns:repeat(6,minmax(0,1fr))}
    @media(max-width:980px){.board{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .col{border:1px solid var(--line);border-radius:16px;overflow:hidden;background:rgba(255,255,255,.03)}
    .colHead{padding:10px 8px;text-align:center;font-weight:1000;background:rgba(255,255,255,.05);border-bottom:1px solid var(--line);min-height:52px;display:flex;align-items:center;justify-content:center}
    .cell button{width:100%;border:0;border-bottom:1px solid var(--line);border-radius:0;background:transparent;padding:16px 8px;font-size:18px}
    .cell button.used{opacity:.35;text-decoration:line-through}
    .cell:last-child button{border-bottom:0}
    .p200{color:#bfefff}.p400{color:#d7c8ff}.p600{color:#ffd0b2}

    .catsGrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px}
    .catCard{padding:12px;cursor:pointer}
    .catCard.on{background:rgba(103,232,249,.10);border-color:rgba(103,232,249,.35)}
    .catCard.off{background:rgba(255,255,255,.03)}
    hr.sep{border:none;border-top:1px solid var(--line);margin:10px 0}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:50;padding:16px}
    .modal.show{display:flex}
    .modalCard{width:min(920px,100%);background:rgba(12,16,30,.92);border:1px solid var(--line);border-radius:18px;overflow:hidden}
    .modalTop{display:flex;justify-content:space-between;align-items:center;gap:12px;padding:12px 14px;border-bottom:1px solid var(--line)}
    .modalTop .meta{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .modalBody{padding:14px}
    .qtext{font-size:18px;font-weight:900;line-height:1.5;margin:0 0 10px}
    .ans{display:none;margin-top:10px;padding:10px 12px;border-radius:14px;border:1px dashed rgba(255,255,255,.22);background:rgba(255,255,255,.04)}
    .ans.show{display:block}
    .ans .lbl{font-size:12px;color:var(--muted);margin-bottom:6px}
    .ans .aval{font-size:18px;font-weight:1000}
    .qimg{width:100%;max-height:360px;object-fit:contain;border-radius:16px;border:1px solid var(--line);background:rgba(0,0,0,.25)}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .actions button{flex:1;min-width:160px}
    .subpanel{display:none;margin-top:12px;padding:10px;border-radius:14px;border:1px solid var(--line);background:rgba(255,255,255,.03)}
    .subpanel.show{display:block}
    .teamBtns{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    .teamBtns button{flex:1;min-width:160px}
  </style>
</head>

<body>
<header>
  <div class="topbar">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>Ø³ÙŠÙ† Ø¬ÙŠÙ… â€” Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ©</h1>
        <div class="sub">Ø§Ø®ØªÙŠØ§Ø± 3â€“6 ØªØµÙ†ÙŠÙØ§Øª â€¢ Ù„ÙˆØ­Ø© 6Ã—6 â€¢ Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ø®ØªÙŠØ§Ø±ÙŠ</div>
      </div>
    </div>
    <div class="btns">
      <button id="goSetup">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      <button id="goSelect">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</button>
      <button id="goGame" class="primary">Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
      <button id="wipe" class="danger">ğŸ§¹ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    </div>
  </div>
</header>

<div class="container">

  <!-- Setup -->
  <div id="pageSetup" class="page active">
    <div class="grid two">
      <div class="card">
        <div class="titleRow">
          <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙØ±Ù‚</h2>
          <div class="small">ØªÙ†Ø­ÙØ¸ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§</div>
        </div>
        <div class="field">
          <label>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</label>
          <input id="team1Name" type="text" placeholder="Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„">
        </div>
        <div class="field">
          <label>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
          <input id="team2Name" type="text" placeholder="Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ">
        </div>
        <div class="row">
          <button id="resetScores" class="danger">ØªØµÙÙŠØ± Ø§Ù„Ù†Ù‚Ø§Ø·</button>
          <span class="pill">Ù†Ù‚Ø§Ø·: 200 / 400 / 600</span>
        </div>
        <div class="small" style="margin-top:10px">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ‚ ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ· Â«ØµØ­Â» âœ…</div>
      </div>

      <div class="card">
        <div class="titleRow">
          <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
          <div class="small">Ù…Ø¤Ù‚Ù‘Øª + Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø±</div>
        </div>
        <div class="field">
          <label>Ù…Ø¯Ø© Ø§Ù„Ù…Ø¤Ù‚Ù‘Øª (Ø«ÙˆØ§Ù†ÙŠ) Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„</label>
          <input id="timerSec" type="number" min="5" step="1" placeholder="Ù…Ø«Ø§Ù„: 30">
        </div>

        <div class="toggle">
          <input id="noRepeatAcross" type="checkbox">
          <label for="noRepeatAcross">Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¹Ø¨Ø± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        </div>

        <div class="row" style="margin-top:12px">
          <button id="newBoard" class="primary">Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
          <span class="pill" id="bankStats">â€”</span>
        </div>

        <hr class="sep">
        <div class="small">ØªÙ‚Ø¯Ø± ØªØ²ÙŠØ¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø¨Ø³Ù‡ÙˆÙ„Ø© Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯: BANK (ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„).</div>
      </div>
    </div>
  </div>

  <!-- Select -->
  <div id="pageSelect" class="page">
    <div class="card">
      <div class="titleRow">
        <h2>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª (3 Ø¥Ù„Ù‰ 6)</h2>
        <div class="small">Ø¥Ø°Ø§ Ø§Ø®ØªØ±Øª Ø£Ù‚Ù„ Ù…Ù† 6ØŒ ÙŠØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§</div>
      </div>

      <div class="row" style="margin-bottom:10px">
        <span class="pill" id="selCount">0 Ù…Ø®ØªØ§Ø±</span>
        <span class="pill">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ†ÙŠÙ Ù„Ù„ØªØ­Ø¯ÙŠØ¯</span>
      </div>

      <div id="catsGrid" class="catsGrid"></div>

      <hr class="sep">
      <div class="row">
        <button id="confirmCats" class="primary">ØªØ£ÙƒÙŠØ¯ + Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø©</button>
        <button id="randomCats">Ø§Ø®ØªÙŠØ§Ø± Ø¹Ø´ÙˆØ§Ø¦ÙŠ</button>
        <button id="clearCats" class="danger">Ù…Ø³Ø­ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±</button>
      </div>
    </div>
  </div>

  <!-- Game -->
  <div id="pageGame" class="page">
    <div class="scorebar">
      <div class="scorebox"><span class="name" id="t1N">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„</span> <span class="score" id="t1S">0</span></div>
      <div class="scorebox"><span class="timer" id="timer">00:00</span> <span class="pill" id="timerState">Ø¬Ø§Ù‡Ø²</span></div>
      <div class="scorebox"><span class="name" id="t2N">Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ</span> <span class="score" id="t2S">0</span></div>
    </div>

    <div class="card">
      <div class="titleRow">
        <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
        <div class="small" id="boardMeta">â€”</div>
      </div>
      <div id="board" class="board"></div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="modal">
  <div class="modalCard">
    <div class="modalTop">
      <div class="meta">
        <span class="pill" id="mCat"></span>
        <span class="pill" id="mPts"></span>
      </div>
      <button id="mClose">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
    <div class="modalBody">
      <p class="qtext" id="mQ"></p>
      <img id="mImg" class="qimg" style="display:none">
      <div id="mAnsBox" class="ans">
        <div class="lbl">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</div>
        <div class="aval" id="mA"></div>
      </div>

      <div class="actions">
        <button id="mShow" class="primary">Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</button>
        <button id="mCorrect" style="border-color:rgba(34,197,94,.45)">ØµØ­ âœ…</button>
        <button id="mWrong" class="danger">ØºÙ„Ø· âŒ</button>
      </div>

      <div id="panelWho" class="subpanel">
        <div style="font-weight:900">Ù…Ù† Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ù„ÙŠ Ø¬Ø§ÙˆØ¨ ØµØ­ØŸ</div>
        <div class="teamBtns">
          <button id="awardT1"></button>
          <button id="awardT2"></button>
          <button id="awardNone" class="danger">Ù„Ø§ Ø£Ø­Ø¯</button>
        </div>
      </div>

      <div id="panelSteal" class="subpanel">
        <div style="font-weight:900">Ø³Ø±Ù‚Ø©ØŸ (Ø¥Ø°Ø§ ÙØ±ÙŠÙ‚ Ø«Ø§Ù†ÙŠ Ø¬Ø§ÙˆØ¨ ØµØ­)</div>
        <div class="teamBtns">
          <button id="stealT1"></button>
          <button id="stealT2"></button>
          <button id="stealNone" class="danger">Ù„Ø§ Ø³Ø±Ù‚Ø©</button>
        </div>
      </div>

      <div class="small" style="margin-top:10px">
        ØªØ°ÙƒÙŠØ±: Ø£Ù†Øª Ø·Ù„Ø¨Øª Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ø¹Ø¯ Â«ØµØ­Â»ØŒ ÙˆÙ‡Ø°Ø§ Ø§Ù„Ù„ÙŠ ÙŠØµÙŠØ±.
      </div>
    </div>
  </div>
</div>

<script>
/* ===========================
   1) Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù…Ø¨Ø¯Ø¦ÙŠ)
   ØªÙ‚Ø¯Ø± ØªØ²ÙŠØ¯Ù‡ØŒ Ø£Ùˆ ØªØ³ØªØ¨Ø¯Ù„Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø¨Ù†ÙƒÙƒ.
   Ø´ÙƒÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„:
   {cat:"...", pts:200|400|600, q:"Ø§Ù„Ø³Ø¤Ø§Ù„", a:"Ø§Ù„Ø¬ÙˆØ§Ø¨", img:"data-uri (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"}
=========================== */
const BANK = [
  // Ø£Ù…Ø«Ù„Ø© Ù‚ÙˆÙŠØ© ÙˆÙ…Ø¨Ø§Ø´Ø±Ø© (Ø¨Ø¯ÙˆÙ† â€œØ§Ø´Ø±Ø­â€ Ø£Ùˆ â€œØ³Ø¨Ø¨â€)
  {cat:"Ø¹ÙˆØ§ØµÙ… Ø§Ù„Ø¹Ø±Ø¨", pts:200, q:"Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªØŸ", a:"Ø£Ø¨ÙˆØ¸Ø¨ÙŠ"},
  {cat:"Ø¹ÙˆØ§ØµÙ… Ø§Ù„Ø¹Ø±Ø¨", pts:400, q:"Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ø¹ÙÙ…Ø§Ù†ØŸ", a:"Ù…Ø³Ù‚Ø·"},
  {cat:"Ø¹ÙˆØ§ØµÙ… Ø§Ù„Ø¹Ø±Ø¨", pts:600, q:"Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ø¬Ø²Ø± Ø§Ù„Ù‚Ù…Ø±ØŸ", a:"Ù…ÙˆØ±ÙˆÙ†ÙŠ"},

  {cat:"Ø¹ÙˆØ§ØµÙ… Ø£ÙˆØ±ÙˆØ¨Ø§", pts:200, q:"Ù…Ø§ Ø¹Ø§ØµÙ…Ø© ÙØ±Ù†Ø³Ø§ØŸ", a:"Ø¨Ø§Ø±ÙŠØ³"},
  {cat:"Ø¹ÙˆØ§ØµÙ… Ø£ÙˆØ±ÙˆØ¨Ø§", pts:400, q:"Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ø§Ù„Ù†Ø±ÙˆÙŠØ¬ØŸ", a:"Ø£ÙˆØ³Ù„Ùˆ"},
  {cat:"Ø¹ÙˆØ§ØµÙ… Ø£ÙˆØ±ÙˆØ¨Ø§", pts:600, q:"Ù…Ø§ Ø¹Ø§ØµÙ…Ø© Ù…ÙˆÙ„Ø¯ÙˆÙØ§ØŸ", a:"ÙƒÙŠØ´ÙŠÙ†Ø§Ùˆ"},

  {cat:"Ø§Ø®ØªØµØ§Ø±Ø§Øª ØªÙ‚Ù†ÙŠØ©", pts:200, q:"Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ø®ØªØµØ§Ø± RAMØŸ", a:"Ø°Ø§ÙƒØ±Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ"},
  {cat:"Ø§Ø®ØªØµØ§Ø±Ø§Øª ØªÙ‚Ù†ÙŠØ©", pts:400, q:"Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ø®ØªØµØ§Ø± VPNØŸ", a:"Ø´Ø¨ÙƒØ© Ø®Ø§ØµØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©"},
  {cat:"Ø§Ø®ØªØµØ§Ø±Ø§Øª ØªÙ‚Ù†ÙŠØ©", pts:600, q:"Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ø®ØªØµØ§Ø± BGPØŸ", a:"Border Gateway Protocol"},

  {cat:"ÙƒØ±Ø© Ù‚Ø¯Ù…: ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù…", pts:200, q:"Ù…Ù† ÙØ§Ø² Ø¨ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… 2022ØŸ", a:"Ø§Ù„Ø£Ø±Ø¬Ù†ØªÙŠÙ†"},
  {cat:"ÙƒØ±Ø© Ù‚Ø¯Ù…: ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù…", pts:400, q:"ÙÙŠ Ø£ÙŠ Ø¯ÙˆÙ„Ø© Ø£Ù‚ÙŠÙ… ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… 2022ØŸ", a:"Ù‚Ø·Ø±"},
  {cat:"ÙƒØ±Ø© Ù‚Ø¯Ù…: ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù…", pts:600, q:"Ù…Ù† Ø³Ø¬Ù„ Ù‡Ø§ØªØ±ÙŠÙƒ ÙÙŠ Ù†Ù‡Ø§Ø¦ÙŠ 2022ØŸ", a:"ÙƒÙŠÙ„ÙŠØ§Ù† Ù…Ø¨Ø§Ø¨ÙŠ"},

  {cat:"Ø£Ù†Ù…ÙŠ: Naruto", pts:200, q:"Ù…Ø§ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ù†Ø§Ø±ÙˆØªÙˆØŸ", a:"Ø£ÙˆØ²ÙˆÙ…Ø§ÙƒÙŠ"},
  {cat:"Ø£Ù†Ù…ÙŠ: Naruto", pts:400, q:"Ù…Ø§ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ù…ÙŠÙ†Ø§ØªÙˆØŸ", a:"Ù†Ø§Ù…ÙŠÙƒØ§Ø²ÙŠ"},
  {cat:"Ø£Ù†Ù…ÙŠ: Naruto", pts:600, q:"Ù…Ø§ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ø´ÙŠÙƒØ§Ù…Ø§Ø±ÙˆØŸ", a:"Ù†Ø§Ø±Ø§"},

  {cat:"Ø£Ù†Ù…ÙŠ: Attack on Titan", pts:200, q:"Ù…Ø§ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ù„ÙŠÙØ§ÙŠØŸ", a:"Ø£ÙƒØ±Ù…Ø§Ù†"},
  {cat:"Ø£Ù†Ù…ÙŠ: Attack on Titan", pts:400, q:"Ù…Ø§ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ø¥ÙŠØ±ÙˆÙŠÙ†ØŸ", a:"Ø³Ù…ÙŠØ«"},
  {cat:"Ø£Ù†Ù…ÙŠ: Attack on Titan", pts:600, q:"Ù…Ø§ Ø§Ø³Ù… Ø¹Ø§Ø¦Ù„Ø© Ø¢Ù†ÙŠØŸ", a:"Ù„ÙŠÙˆÙ† Ù‡Ø§Ø±Øª"},

  {cat:"Ø£ÙÙ„Ø§Ù…", pts:200, q:"Ù…Ù† Ù…Ø®Ø±Ø¬ ÙÙŠÙ„Ù… InceptionØŸ", a:"Christopher Nolan"},
  {cat:"Ø£ÙÙ„Ø§Ù…", pts:400, q:"Ù…Ù† Ù…Ø®Ø±Ø¬ ÙÙŠÙ„Ù… Dune (2021)ØŸ", a:"Denis Villeneuve"},
  {cat:"Ø£ÙÙ„Ø§Ù…", pts:600, q:"Ù…Ù† Ù…Ø®Ø±Ø¬ ÙÙŠÙ„Ù… ParasiteØŸ", a:"Bong Joon-ho"},

  {cat:"Ù…Ø³Ù„Ø³Ù„Ø§Øª", pts:200, q:"Ù…Ù† Ø¨Ø·Ù„ Ù…Ø³Ù„Ø³Ù„ The MentalistØŸ", a:"Patrick Jane"},
  {cat:"Ù…Ø³Ù„Ø³Ù„Ø§Øª", pts:400, q:"Ù…Ù† Ø¨Ø·Ù„ Ù…Ø³Ù„Ø³Ù„ Peaky BlindersØŸ", a:"Tommy Shelby"},
  {cat:"Ù…Ø³Ù„Ø³Ù„Ø§Øª", pts:600, q:"Ù…Ù† Ø¨Ø·Ù„ Ù…Ø³Ù„Ø³Ù„ HouseØŸ", a:"Gregory House"},

  {cat:"Ø£Ø¯Ø¨", pts:200, q:"Ù…Ø§ Ø§Ø³Ù… Ø¹Ù„Ù… Ù‚ÙŠØ§Ø³ Ø§Ù„Ø´Ø¹Ø± Ø§Ù„Ø¹Ø±Ø¨ÙŠØŸ", a:"Ø§Ù„Ø¹ÙØ±ÙˆØ¶"},
  {cat:"Ø£Ø¯Ø¨", pts:400, q:"Ù…Ù† ÙˆØ§Ø¶Ø¹ Ø¹Ù„Ù… Ø§Ù„Ø¹ÙØ±ÙˆØ¶ØŸ", a:"Ø§Ù„Ø®Ù„ÙŠÙ„ Ø¨Ù† Ø£Ø­Ù…Ø¯ Ø§Ù„ÙØ±Ø§Ù‡ÙŠØ¯ÙŠ"},
  {cat:"Ø£Ø¯Ø¨", pts:600, q:"Ù…Ø§ Ø§Ø³Ù… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù‚ØµÙŠØ¯Ø©ØŸ", a:"Ø§Ù„Ù…Ø·Ù„Ø¹"},

  {cat:"Ø³Ø¨ÙŠØ³ØªÙˆÙ†", pts:200, q:"Ù…Ø§ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙŠ Ø§Ø´ØªÙ‡Ø±Øª Ø¨Ø¯Ø¨Ù„Ø¬Ø© Ø§Ù„Ø£Ù†Ù…ÙŠ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ© ÙÙŠ Ø§Ù„ØªØ³Ø¹ÙŠÙ†Ø§ØªØŸ", a:"Ø³Ø¨ÙŠØ³ØªÙˆÙ†"},
  {cat:"Ø³Ø¨ÙŠØ³ØªÙˆÙ†", pts:400, q:"Ù…Ø§ Ø§Ø³Ù… Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„ Ø§Ù„Ø´Ù‡ÙŠØ± Ø¹Ù„Ù‰ Ø³Ø¨ÙŠØ³ØªÙˆÙ†ØŸ", a:"Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„ÙƒØ±Ø© (ÙƒÙ…Ø«Ø§Ù„)"},
  {cat:"Ø³Ø¨ÙŠØ³ØªÙˆÙ†", pts:600, q:"Ø§Ø°ÙƒØ± Ø§Ø³Ù… Ø´Ø®ØµÙŠØ© Ø±Ø¦ÙŠØ³ÙŠØ© ÙÙŠ Ù…Ø³Ù„Ø³Ù„ ÙƒØ±ØªÙˆÙ† Ù‚Ø¯ÙŠÙ… (Ø§Ø®ØªÙŠØ§Ø± ÙˆØ§Ø­Ø¯ ØµØ­ÙŠØ­):", a:"(Ù…Ø«Ø§Ù„) Ø¹Ø¯Ù†Ø§Ù†"},

  // Ø²ÙŠØ¯ Ù‡Ù†Ø§ Ø£Ø³Ø¦Ù„ØªÙƒ (Ø§Ù„Ø£ÙØ¶Ù„: Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ù‚ÙˆØ§Ø¦Ù… ÙƒØ«ÙŠØ±Ø©ØŒ ÙˆØ¨Ù†ÙØ³ Ø£Ø³Ù„ÙˆØ¨ Ù…Ø¨Ø§Ø´Ø±)
];

// ØªÙˆÙ„ÙŠØ¯ ID Ø«Ø§Ø¨Øª Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¹Ø¨Ø± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨
function makeId(o){
  return btoa(unescape(encodeURIComponent(`${o.cat}|${o.pts}|${o.q}|${o.img||""}`))).slice(0,18);
}
for (const q of BANK){ q.id = q.id || makeId(q); }

/* ===========================
   2) ØªØ®Ø²ÙŠÙ† (LocalStorage)
=========================== */
const K = {
  settings:"sj_settings_v1",
  scores:"sj_scores_v1",
  selection:"sj_selection_v1",
  board:"sj_board_v1",
  usedGlobal:"sj_used_global_v1",
  usedCells:"sj_used_cells_v1"
};

function loadJSON(key, fallback){
  try{ const v = localStorage.getItem(key); return v ? JSON.parse(v) : fallback; }
  catch(e){ return fallback; }
}
function saveJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
function $(id){ return document.getElementById(id); }

function getSettings(){
  return loadJSON(K.settings, {team1:"Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„", team2:"Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ", timer:30, noRepeat:false});
}
function setSettings(s){ saveJSON(K.settings, s); }
function getScores(){ return loadJSON(K.scores, {t1:0,t2:0}); }
function setScores(sc){ saveJSON(K.scores, sc); renderScore(); }
function clearAll(){
  Object.values(K).forEach(k=>localStorage.removeItem(k));
  location.reload();
}

/* ===========================
   3) ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
=========================== */
const byCat = new Map();
for (const q of BANK){
  if (!byCat.has(q.cat)) byCat.set(q.cat, []);
  byCat.get(q.cat).push(q);
}
// ØªØ±ØªÙŠØ¨: Ø­Ø³Ø¨ pts Ø«Ù… Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
for (const [cat, arr] of byCat.entries()){
  arr.sort((a,b)=> (a.pts-b.pts) || a.q.localeCompare(b.q));
}

function showPage(name){
  ["Setup","Select","Game"].forEach(p=>$("page"+p).classList.remove("active"));
  $("page"+name).classList.add("active");
}

/* ===========================
   4) ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
=========================== */
function initSetup(){
  const s = getSettings();
  $("team1Name").value = s.team1;
  $("team2Name").value = s.team2;
  $("timerSec").value = s.timer;
  $("noRepeatAcross").checked = !!s.noRepeat;

  $("team1Name").addEventListener("input", ()=>{
    const ns = getSettings(); ns.team1 = $("team1Name").value.trim() || "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£ÙˆÙ„";
    setSettings(ns); renderScore();
  });
  $("team2Name").addEventListener("input", ()=>{
    const ns = getSettings(); ns.team2 = $("team2Name").value.trim() || "Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø«Ø§Ù†ÙŠ";
    setSettings(ns); renderScore();
  });
  $("timerSec").addEventListener("input", ()=>{
    const ns = getSettings(); ns.timer = Math.max(5, parseInt($("timerSec").value||"30",10));
    setSettings(ns);
  });
  $("noRepeatAcross").addEventListener("change", ()=>{
    const ns = getSettings(); ns.noRepeat = $("noRepeatAcross").checked;
    setSettings(ns);
  });

  $("resetScores").onclick = ()=> setScores({t1:0,t2:0});
  $("newBoard").onclick = ()=> showPage("Select");

  $("bankStats").textContent = `${byCat.size} ØªØµÙ†ÙŠÙ â€¢ ${BANK.length} Ø³Ø¤Ø§Ù„`;
}

/* ===========================
   5) Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
=========================== */
let selected = new Set(loadJSON(K.selection, []));

function allCats(){
  const cats = Array.from(byCat.keys());
  cats.sort((a,b)=>a.localeCompare(b));
  return cats;
}

function renderCats(){
  const grid = $("catsGrid");
  grid.innerHTML = "";
  for (const cat of allCats()){
    const items = byCat.get(cat) || [];
    const c200 = items.filter(x=>x.pts===200).length;
    const c400 = items.filter(x=>x.pts===400).length;
    const c600 = items.filter(x=>x.pts===600).length;

    const div = document.createElement("div");
    div.className = "card catCard " + (selected.has(cat) ? "on":"off");
    div.innerHTML = `
      <div style="display:flex;justify-content:space-between;gap:8px;align-items:center">
        <div style="font-weight:1000">${cat}</div>
        <div class="pill">${items.length} Ø³Ø¤Ø§Ù„</div>
      </div>
      <div class="small" style="margin-top:6px">200: ${c200} â€¢ 400: ${c400} â€¢ 600: ${c600}</div>
    `;
    div.onclick = ()=>{
      if (selected.has(cat)) selected.delete(cat);
      else {
        if (selected.size >= 6) return alert("Ù…Ø³Ù…ÙˆØ­ 6 ØªØµÙ†ÙŠÙØ§Øª ÙÙ‚Ø·");
        selected.add(cat);
      }
      saveJSON(K.selection, Array.from(selected));
      renderCats();
    };
    grid.appendChild(div);
  }
  $("selCount").textContent = `${selected.size} Ù…Ø®ØªØ§Ø±`;
}

function randomCats(){
  const pool = allCats();
  selected = new Set();
  while (selected.size < 6 && pool.length){
    selected.add(pool.splice(Math.floor(Math.random()*pool.length),1)[0]);
  }
  saveJSON(K.selection, Array.from(selected));
  renderCats();
}
function clearCats(){
  selected = new Set();
  saveJSON(K.selection, []);
  renderCats();
}

/* ===========================
   6) Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù„ÙˆØ­Ø© (6 Ø£Ø³Ø¦Ù„Ø© Ù„ÙƒÙ„ ØªØµÙ†ÙŠÙ)
   200/200/400/400/600/600
   Ø¨Ø¯ÙˆÙ† ØªÙƒØ±Ø§Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„Ù„ÙˆØ­Ø©
   + Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø¹Ø¨Ø± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨
=========================== */
const POINTS = [200,200,400,400,600,600];

function usedGlobalSet(){
  const s = getSettings();
  if (!s.noRepeat) return new Set();
  return new Set(loadJSON(K.usedGlobal, []));
}
function saveUsedGlobal(set){
  const s = getSettings();
  if (!s.noRepeat) return;
  saveJSON(K.usedGlobal, Array.from(set));
}
function sample(arr,k){
  const a = arr.slice(); const out=[];
  while(out.length<k && a.length){
    out.push(a.splice(Math.floor(Math.random()*a.length),1)[0]);
  }
  return out;
}

function buildBoard(){
  if (selected.size < 3) return alert("Ø§Ø®ØªØ± 3 ØªØµÙ†ÙŠÙØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  let cats = Array.from(selected);

  // Ø£ÙƒÙ…Ù„ Ø¥Ù„Ù‰ 6 Ø¹Ø´ÙˆØ§Ø¦ÙŠÙ‹Ø§ Ø¥Ø°Ø§ Ø£Ù‚Ù„
  if (cats.length < 6){
    const pool = allCats().filter(c=>!selected.has(c));
    while(cats.length < 6 && pool.length){
      cats.push(pool.splice(Math.floor(Math.random()*pool.length),1)[0]);
    }
  }
  cats = cats.slice(0,6);

  const usedG = usedGlobalSet();
  const board = {cats:[], cells:{}};

  for (const cat of cats){
    const all = byCat.get(cat) || [];
    // Ø§Ù„Ø£ÙØ¶Ù„: Ø§Ø®ØªØ± Ù…Ù† ØºÙŠØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø§Ù„Ù…ÙŠÙ‹Ø§
    let pool = all.filter(q=>!usedG.has(q.id));
    if (pool.length < 6) pool = all; // Ù„Ùˆ Ø®Ù„ØµØŒ Ø±Ø¬Ø¹ Ù„Ù„ÙƒÙ„

    // ØªÙ‚Ø³ÙŠÙ… Ø­Ø³Ø¨ Ø§Ù„ØµØ¹ÙˆØ¨Ø© (Ø­Ø³Ø¨ pts) Ù„ÙƒÙ† Ù…Ø¹ Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
    const low = pool.filter(x=>x.pts===200);
    const mid = pool.filter(x=>x.pts===400);
    const high = pool.filter(x=>x.pts===600);

    let picked = [];
    picked = picked.concat(sample(low,2));
    picked = picked.concat(sample(mid,2));
    picked = picked.concat(sample(high,2));

    // Ù„Ùˆ Ù†Ù‚ØµØŒ ÙƒÙ…Ù„ Ù…Ù† Ø£ÙŠ Ù…ÙƒØ§Ù†
    const ids = new Set(picked.map(x=>x.id));
    while(picked.length<6 && pool.length){
      const q = pool[Math.floor(Math.random()*pool.length)];
      if (!ids.has(q.id)){ picked.push(q); ids.add(q.id); }
      else break;
    }

    board.cats.push(cat);
    for (let r=0;r<6;r++){
      board.cells[`${cat}|${r}`] = picked[r] || pool[r%pool.length];
    }
  }

  saveJSON(K.board, board);
  saveJSON(K.usedCells, {}); // Ù„ÙˆØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© = reset
  $("boardMeta").textContent = `Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${new Date().toLocaleString('ar')}`;
  renderBoard();
  showPage("Game");
}

function renderBoard(){
  const boardEl = $("board");
  boardEl.innerHTML = "";
  const board = loadJSON(K.board, null);
  if (!board){
    boardEl.innerHTML = `<div class="small">Ù…Ø§ÙÙŠ Ù„ÙˆØ­Ø© Ø¨Ø¹Ø¯ â€” Ø±ÙˆØ­ "Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª"</div>`;
    return;
  }
  const usedCells = loadJSON(K.usedCells, {});
  board.cats.forEach(cat=>{
    const col = document.createElement("div");
    col.className = "col";
    const head = document.createElement("div");
    head.className = "colHead";
    head.textContent = cat;
    col.appendChild(head);

    POINTS.forEach((pts,r)=>{
      const key = `${cat}|${r}`;
      const q = board.cells[key];
      const cell = document.createElement("div");
      cell.className = "cell";
      const b = document.createElement("button");
      b.textContent = pts;
      b.className = (pts===200?"p200":pts===400?"p400":"p600") + (usedCells[key]?" used":"");
      b.onclick = ()=>{
        if (usedCells[key]) return;
        openQuestion(cat, pts, r, q);
      };
      cell.appendChild(b);
      col.appendChild(cell);
    });

    boardEl.appendChild(col);
  });
}

/* ===========================
   7) Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ + Ø§Ù„Ù…Ø¤Ù‚Ù‘Øª + Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·
=========================== */
let current=null;
let timerInt=null;
let timerLeft=0;

function tickTimer(){
  const m = String(Math.floor(timerLeft/60)).padStart(2,"0");
  const s = String(timerLeft%60).padStart(2,"0");
  $("timer").textContent = `${m}:${s}`;
}
function startTimer(sec){
  clearInterval(timerInt);
  timerLeft = sec;
  $("timerState").textContent = "ÙŠØ´ØªØºÙ„";
  tickTimer();
  timerInt = setInterval(()=>{
    timerLeft--;
    tickTimer();
    if (timerLeft<=0){
      clearInterval(timerInt);
      $("timerState").textContent = "Ø§Ù†ØªÙ‡Ù‰";
    }
  },1000);
}
function stopTimer(){
  clearInterval(timerInt);
  $("timerState").textContent = "Ø¬Ø§Ù‡Ø²";
}

function openQuestion(cat, pts, row, q){
  current = {cat, pts, row, q};
  $("mCat").textContent = cat;
  $("mPts").textContent = `${pts} Ù†Ù‚Ø·Ø©`;
  $("mQ").textContent = q.q;
  $("mA").textContent = q.a;

  $("mAnsBox").classList.remove("show");
  $("panelWho").classList.remove("show");
  $("panelSteal").classList.remove("show");

  if (q.img){
    $("mImg").src = q.img;
    $("mImg").style.display = "block";
  } else {
    $("mImg").style.display = "none";
  }

  $("modal").classList.add("show");
  startTimer(getSettings().timer || 30);
}

function markUsed(){
  const usedCells = loadJSON(K.usedCells, {});
  usedCells[`${current.cat}|${current.row}`] = true;
  saveJSON(K.usedCells, usedCells);

  const s = getSettings();
  if (s.noRepeat){
    const usedG = usedGlobalSet();
    usedG.add(current.q.id);
    saveUsedGlobal(usedG);
  }
  renderBoard();
}

function closeModal(){
  stopTimer();
  $("modal").classList.remove("show");
  $("mAnsBox").classList.remove("show");
  $("panelWho").classList.remove("show");
  $("panelSteal").classList.remove("show");
  current=null;
}

function renderScore(){
  const s = getSettings();
  const sc = getScores();
  $("t1N").textContent = s.team1;
  $("t2N").textContent = s.team2;
  $("t1S").textContent = sc.t1;
  $("t2S").textContent = sc.t2;

  $("awardT1").textContent = s.team1;
  $("awardT2").textContent = s.team2;
  $("stealT1").textContent = s.team1;
  $("stealT2").textContent = s.team2;
}

/* ===========================
   8) Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
=========================== */
$("goSetup").onclick = ()=>showPage("Setup");
$("goSelect").onclick = ()=>{ showPage("Select"); renderCats(); };
$("goGame").onclick = ()=>{ showPage("Game"); renderBoard(); };
$("wipe").onclick = ()=>{ if(confirm("Ø£ÙƒÙŠØ¯ ØªØ¨ØºÙŠ ØªÙ…Ø³Ø­ ÙƒÙ„ Ø´ÙŠØŸ")) clearAll(); };

$("confirmCats").onclick = buildBoard;
$("randomCats").onclick = randomCats;
$("clearCats").onclick = clearCats;

$("mClose").onclick = closeModal;
$("modal").addEventListener("click", e=>{ if(e.target.id==="modal") closeModal(); });

$("mShow").onclick = ()=> $("mAnsBox").classList.add("show");

$("mCorrect").onclick = ()=>{
  $("mAnsBox").classList.add("show");
  $("panelSteal").classList.remove("show");
  $("panelWho").classList.add("show"); // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±ÙŠÙ‚ Ø¨Ø¹Ø¯ "ØµØ­"
};

$("mWrong").onclick = ()=>{
  $("mAnsBox").classList.add("show");
  $("panelWho").classList.remove("show");
  $("panelSteal").classList.add("show"); // Ø³Ø±Ù‚Ø©
};

function award(team){
  const sc = getScores();
  if (team==="t1") sc.t1 += current.pts;
  if (team==="t2") sc.t2 += current.pts;
  setScores(sc);
  markUsed();
  closeModal();
}
function noAward(){
  markUsed();
  closeModal();
}

$("awardT1").onclick = ()=>award("t1");
$("awardT2").onclick = ()=>award("t2");
$("awardNone").onclick = ()=>noAward();

$("stealT1").onclick = ()=>award("t1");
$("stealT2").onclick = ()=>award("t2");
$("stealNone").onclick = ()=>noAward();

/* ===========================
   9) ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
=========================== */
initSetup();
renderScore();
renderCats();
renderBoard();
timerLeft = getSettings().timer || 30;
tickTimer();
</script>

</body>
</html>
